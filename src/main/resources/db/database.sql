create database photocontest
    with owner postgres;

create table public.app_user
(
    id       bigint generated by default as identity
        primary key,
    email    varchar(255) not null
        unique,
    password varchar(255) not null,
    username varchar(255) not null
        unique
);

alter table public.app_user
    owner to postgres;

create table public.roles
(
    role_id   integer generated by default as identity
        primary key,
    authority varchar(255) not null
        unique
);

alter table public.roles
    owner to postgres;

create table public.user_roles
(
    role_id integer not null
        constraint fkh8ciramu9cc9q3qcqiv4ue8a6
            references public.roles,
    user_id bigint  not null
        constraint fk6fql8djp64yp4q9b3qeyhr82b
            references public.app_user,
    primary key (role_id, user_id)
);

alter table public.user_roles
    owner to postgres;

create table public.user_profile
(
    app_user_id bigint
        unique
        constraint fkq87ntg2w4c5q6r791cis2gbxx
            references public.app_user,
    id          bigint generated by default as identity
        primary key,
    first_name  varchar(26),
    last_name   varchar(26),
    rank        varchar(255)
        constraint user_profile_rank_check
            check ((rank)::text = ANY
        ((ARRAY ['JUNKIE'::character varying, 'ENTHUSIAST'::character varying, 'ORGANISER'::character varying, 'MASTER'::character varying])::text[]))
    );

alter table public.user_profile
    owner to postgres;

create table public.contest
(
    created_at             timestamp(6),
    end_date_time_phase1   timestamp(6),
    end_date_time_phase2   timestamp(6),
    id                     bigint generated by default as identity
        primary key,
    phase_id               bigint,
    start_date_time_phase1 timestamp(6),
    start_date_time_phase2 timestamp(6),
    updated_at             timestamp(6),
    user_profile_id        bigint
        constraint fk7v73ododrqogsbtamlpr65jne
            references public.user_profile,
    category               varchar(255)
        constraint contest_category_check
            check ((category)::text = ANY
        ((ARRAY ['LANDSCAPE'::character varying, 'PORTRAIT'::character varying, 'STREET'::character varying, 'WILDLIFE'::character varying, 'ABSTRACT'::character varying])::text[])),
    title                  varchar(255)
);

alter table public.contest
    owner to postgres;

create table public.contest_jury
(
    app_user_id bigint not null
        constraint fk4qk84m8cfofr3n94sxcdkqisx
            references public.app_user,
    contest_id  bigint not null
        constraint fkin13dngkirloewxhmwup63ru3
            references public.contest
);

alter table public.contest_jury
    owner to postgres;

create table public.contest_participants
(
    app_user_id bigint not null
        constraint fkiegpoaqf7x6o2ikg2qosmw4fd
            references public.app_user,
    contest_id  bigint not null
        constraint fkscq5updfr2dg1lliqs7jn9b8k
            references public.contest
);

alter table public.contest_participants
    owner to postgres;

create table public.phase
(
    contest_id      bigint       not null
        constraint fkerf0b63ljn6gmyrwbj59ss3xj
            references public.contest,
    end_date_time   timestamp(6) not null,
    id              bigint generated by default as identity
        primary key,
    start_date_time timestamp(6) not null,
    type            varchar(255) not null
        constraint phase_type_check
            check ((type)::text = ANY
        ((ARRAY ['PHASE_ONE'::character varying, 'PHASE_TWO'::character varying, 'FINISHED'::character varying])::text[]))
    );

alter table public.phase
    owner to postgres;

alter table public.contest
    add constraint fk4f31xvkb6odejpq70n76mbaq9
        foreign key (phase_id) references public.phase;

create table public.photo_submission
(
    contest_id bigint        not null
        constraint fk5hrhv0v7taudvhdblbcltxa0q
            references public.contest,
    creator_id bigint        not null
        constraint fksyhreqese5oa357jomm3ak8xn
            references public.user_profile,
    id         bigint generated by default as identity
        primary key,
    story      varchar(5000) not null,
    photo_url  varchar(255)  not null,
    title      varchar(255)  not null
);

alter table public.photo_submission
    owner to postgres;

create table public.photo_review
(
    category_mismatch   boolean       not null,
    is_reviewed         boolean       not null,
    score               integer       not null
        constraint photo_review_score_check
            check ((score >= 1) AND (score <= 10)),
    id                  bigint generated by default as identity
        primary key,
    jury_id             bigint        not null
        constraint fkdjbta6vwrx8etkgdpqnl25nw4
            references public.user_profile,
    photo_submission_id bigint        not null
        constraint fkmnnhvdnh20rfv6uhy0m3h2r0j
            references public.photo_submission,
    comment             varchar(5000) not null
);

alter table public.photo_review
    owner to postgres;

